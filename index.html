<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>JRPG Test</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      padding: 0 10%;
      padding-bottom: 10%;
      transition: background-color 0.3s, background-image 0.3s;
      position: relative;
    }

    .team {
      display: flex;
      flex-direction: row;
      gap: 20px;
    }

    .char {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
    }
    .gray { background: gray !important; }

    /* Impostazioni */
    #settings-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      cursor: pointer;
    }

    #settings-modal {
      position: absolute;
      top: 50px;
      right: 10px;
      background: rgba(0,0,0,0.9);
      color: #fff;
      padding: 20px;
      display: none;
      border-radius: 8px;
      max-width: 300px;
      z-index: 100;
    }

    #settings-modal h3 { margin-top: 0; font-size: 16px; }
    #settings-modal label { display: block; margin: 4px 0; cursor: pointer; }
  </style>
</head>
<body>
  <div id="enemies" class="team"></div>
  <div id="heroes" class="team"></div>

  <div id="settings-btn">⚙️</div>
  <div id="settings-modal">
    <h3>Background</h3>
    <div id="bg-options"></div>
    <h3>Eroi</h3>
    <div id="hero-options"></div>
    <h3>Nemici</h3>
    <div id="enemy-options"></div>
  </div>

  <script>
    let heroesData = [];
    let enemiesData = [];
    let backgroundsData = [];
    let selectedBackground = 0;

    async function loadJSON(path) {
      const res = await fetch(path);
      return await res.json();
    }

    async function init() {
      heroesData = await loadJSON('heroes.json');
      enemiesData = await loadJSON('enemies.json');
      backgroundsData = await loadJSON('background.json');

      applyBackground(0);
      renderSettings();
      renderTeams();
    }

    function applyBackground(index) {
      const bg = backgroundsData[index];
      selectedBackground = index;
      if (bg.image) {
        document.body.style.background = `url(${bg.image}) center/cover no-repeat`;
      } else {
        const colors = { wood: '#2ecc71', cave: '#7f8c8d' };
        document.body.style.backgroundColor = colors[bg.name] || '#2ecc71';
        document.body.style.backgroundImage = '';
      }
    }

    function renderTeams() {
      const heroesContainer = document.getElementById('heroes');
      const enemiesContainer = document.getElementById('enemies');
      heroesContainer.innerHTML = '';
      enemiesContainer.innerHTML = '';

      heroesData.filter(h => h.show !== false)
        .forEach(m => addChar(heroesContainer, m, 'blue'));

      enemiesData.filter(e => e.show !== false).forEach(m => {
        const copies = m.copies || 1;
        for (let i = 0; i < copies; i++) {
          addChar(enemiesContainer, m, 'red');
        }
      });
    }

    function addChar(container, m, color) {
      const div = document.createElement('div');
      div.style.display = 'flex';
      div.style.flexDirection = 'column';
      div.style.alignItems = 'center';
      div.style.gap = '4px';

      const img = document.createElement('div');
      img.classList.add('char');
      img.style.background = m.image ? `url(${m.image}) center/cover no-repeat` : color;

      img.addEventListener('click', () => img.classList.toggle('gray'));

      const name = document.createElement('div');
      name.textContent = m.name;
      name.style.color = '#fff';
      name.style.fontSize = '14px';
      name.style.textShadow = '1px 1px 2px black';

      div.appendChild(img);
      div.appendChild(name);
      container.appendChild(div);
    }

    function renderSettings() {
      document.getElementById('settings-btn').onclick = () => {
        const modal = document.getElementById('settings-modal');
        modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
      };

      // Background
      const bgContainer = document.getElementById('bg-options');
      bgContainer.innerHTML = '';
      backgroundsData.forEach((bg, i) => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="radio" name="bg" ${i===0?'checked':''}> ${bg.name}`;
        label.querySelector('input').onclick = () => { applyBackground(i); };
        bgContainer.appendChild(label);
      });

      // Eroi
      const heroContainer = document.getElementById('hero-options');
      heroContainer.innerHTML = '';
      heroesData.forEach((h, i) => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" ${h.show!==false?'checked':''}> ${h.name}`;
        label.querySelector('input').onchange = (e) => { h.show = e.target.checked; renderTeams(); };
        heroContainer.appendChild(label);
      });

      // Nemici
      const enemyContainer = document.getElementById('enemy-options');
      enemyContainer.innerHTML = '';
      enemiesData.forEach((e, i) => {
        const wrapper = document.createElement('div');
        wrapper.style.display = 'flex';
        wrapper.style.alignItems = 'center';
        wrapper.style.gap = '4px';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = e.show !== false;
        checkbox.onchange = (ev) => { e.show = ev.target.checked; renderTeams(); };
        wrapper.appendChild(checkbox);

        const label = document.createElement('span');
        label.textContent = e.name;
        wrapper.appendChild(label);

        const countInput = document.createElement('input');
        countInput.type = 'number';
        countInput.min = 1;
        countInput.value = e.copies || 1;
        countInput.style.width = '40px';
        countInput.onchange = (ev) => {
          const n = parseInt(ev.target.value) || 1;
          e.copies = n;
          renderTeams();
        };
        wrapper.appendChild(countInput);

        enemyContainer.appendChild(wrapper);
      });
    }

    init();
  </script>
</body>
</html>
